from snakemake.utils import min_version

##### set minimum snakemake version #####
min_version("6.4.1")


##### setup report #####
configfile: "config/config.yml"

# import os
# import csv
# import pandas as pd

# METADATA = (
#     pd.read_csv(config["samples"], sep="\t", dtype={"sample_name": str})
#     .set_index("sample_name", drop=False)
#     .sort_index()
# )

# SAMPLES = METADATA["sample_name"]


# OUTDIR="data/reads" 
# TEMPDIR="data/temp"

# if not os.path.exists(OUTDIR):
#    os.makedirs(OUTDIR)

# if not os.path.exists(TEMPDIR):
#    os.makedirs(TEMPDIR)


report: "report/workflow.rst"


##### setup singularity #####


# this container defines the underlying OS for each job when using the workflow
# with --use-conda --use-singularity
# container: "docker://continuumio/miniconda3"


##### load rules #####


include: "rules/common.smk"
include: "rules/import_metadata.smk"
include: "rules/download_sra_fastq.smk"
# include: "rules/resize_fastq_files.smk"

include: "rules/rmd_report.smk"


# Master rule for controlling workflow.
rule all:
    input:
        "index.html",
        "config/samples.tsv",
        "config/units.tsv",     
        gzfq=expand("{outdir}/{sample}.fastq.gz", outdir=OUTDIR, sample=SAMPLES),
        # expand("data/reads/{sample}_{sraNum}.fastq", sample=SAMPLES, sraNum=config["sraNum"]),



